---
apiVersion: v1
kind: ReplicationController
metadata:
  name: accounting-mysql-rc
  labels:
    app: accounting
    tier: accounting-mysql
spec:
  replicas: 1
  template:
    metadata:
      labels:
        name: accounting-mysql-rc
        app: accounting
        tier: accounting-mysql
    spec:
      containers:
        - name: accounting-mysql
          image: mysql:5.6
          ports:
           - containerPort: 3306
             name: mysql
          env:
           - name: MYSQL_ROOT_PASSWORD
             value: PutYourPassWord
          volumeMounts:
           - name: accounting-mysql
             mountPath: /var/lib/mysql
      volumes:
        - name: accounting-mysql
          cinder:
            volumeID: 373b2fb8-446e-483f-bcd9-439e71127992
            fsType: ext4 
---
apiVersion: v1
kind: Service
metadata:
  name: accounting-mysql
  labels:
    app: accounting
spec:
  clusterIP: None
  ports:
  - port: 3306
    protocol: TCP
  selector:
    name: accounting-mysql


---
apiVersion: v1
kind: ReplicationController
metadata:
  name: accounting-server-rc
spec:
  replicas: 1
  selector:
    name: accounting-server-rc
  template:
    metadata:
      labels:
        name: accounting-server-rc
    spec:
      containers:
      - name: accounting
        image: indigodatacloud/accounting:0.1.0-1
        ports:
        - containerPort: 80
          hostPort: 80
        - containerPort: 443
          hostPort: 443
        imagePullPolicy: Always
        env:
          - name: DATA_DB
            value: mysql://root:PutYourPassword@127.0.0.1/accounting-db

---
apiVersion: v1
kind: Service
metadata:
  name: accounting-server
  labels:
    name: accounting-server
spec:
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    name: accounting-http
  - port: 443
    targetPort: 443
    protocol: TCP
    name: accounting-https
  selector:
    name: accounting

